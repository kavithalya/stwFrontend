{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useContext, useState } from \"react\";\nimport { Media, Container, Form, Row, Input, Col } from \"reactstrap\";\nimport { PayPalButton } from \"react-paypal-button\";\nimport CartContext from \"../../../../helpers/cart\";\nimport paypal from \"../../../../public/assets/images/paypal.png\";\nimport { useForm } from \"react-hook-form\";\nimport { useRouter } from \"next/router\";\nimport Axios from \"axios\";\nimport { CurrencyContext } from \"../../../../helpers/Currency/CurrencyContext\";\nimport strip from 'stripe';\nimport GooglePayButton from '@google-pay/button-react'; // import  Razorpay = require('razorpay');\n// const stripe = require('stripe')('pk_live_51IYvwgAR19qkTg2Rtd20aLk5vwFsCRajMN8I9aZl8zFfXj14qDxppEDhfLMp51b9OohTumAh7vSlO6IccIP5iIh600zA024lK7');\n\nexport const getServerSideProps = async () => {\n  const stripe = new Stripe(\"pk_test_51IYvwgAR19qkTg2RIHVWDgFEXkDifm6eeEgXFPxus4HkBdRYEisZHrj97vKXJXr64LlXA3XjCIqtRWvZ5c0l1JTn00X5Apw6MC\");\n  const paymentIntent = await stripe.paymentIntents.create({\n    amount: 1,\n    currency: \"usd\"\n  });\n  return {\n    props: {\n      paymentIntent\n    }\n  };\n};\n\nconst CheckoutPage = () => {\n  const cartContext = useContext(CartContext);\n  const cartItems = cartContext.state;\n  const cartTotal = cartContext.cartTotal.toFixed(2);\n  const curContext = useContext(CurrencyContext);\n  const symbol = curContext.state.symbol;\n  const {\n    0: obj,\n    1: setObj\n  } = useState({});\n  const {\n    0: payment,\n    1: setPayment\n  } = useState(\"Gpay\");\n  const {\n    register,\n    handleSubmit,\n    errors\n  } = useForm(); // initialise the hook\n\n  const router = useRouter();\n\n  const checkhandle = value => {\n    setPayment(value);\n  };\n  /** Launches payment request flow when user taps on buy button. */\n\n\n  const onBuyClicked = () => {\n    const creditCardPaymentMethod = {\n      supportedMethods: 'basic-card',\n      data: {\n        supportedNetworks: ['visa', 'mastercard'],\n        supportedTypes: ['credit', 'debit']\n      }\n    };\n    const supportedInstruments = [{\n      supportedMethods: ['https://tez.google.com/pay'],\n      //supportedMethods:[creditCardPaymentMethod],\n      data: {\n        pa: 'shoptheworld@dbs',\n        pn: 'STW E-Commerce',\n        tr: '123456ABCDEFSD',\n        url: 'http://localhost:3000/page/account/checkout',\n        mc: '5045',\n        tn: 'Purchase in Merchant'\n      }\n    }];\n    var details = {\n      total: {\n        label: 'Total',\n        amount: {\n          currency: 'INR',\n          value: '10.01' //sample amount \n\n        }\n      },\n      displayItems: [{\n        label: 'Original Amount',\n        amount: {\n          currency: 'INR',\n          value: '10.01'\n        }\n      }]\n    };\n    var request = null;\n\n    try {\n      request = new PaymentRequest(supportedInstruments, details);\n      console.log(request);\n      /*request.show()\r\n      .then(function(result){\r\n          alert(\"hai\");\r\n      })\r\n       .catch(function(err){\r\n          alert('Payment Request Error: '+ err.message+' 74'); \r\n      });*/\n    } catch (e) {\n      alert('Payment Request Error: ' + e.message + '77');\n      console.log('Payment Request Error: ' + e.message); //return;\n    }\n\n    if (!request) {\n      alert('Web payments are not supported in this browser 77');\n      console.log('Web payments are not supported in this browser.'); // return;\n    }\n\n    var canMakePaymentPromise = checkCanMakePayment(request);\n    canMakePaymentPromise.then(function (result) {\n      showPaymentUI(request, result);\n    }).catch(function (err) {\n      console.log('Error in calling checkCanMakePayment: ' + err);\n    });\n  };\n\n  const canMakePaymentCache = 'canMakePaymentCache'; // const loadScript=(src) => \n\n  const checkCanMakePayment = request => {\n    // Checks canMakePayment cache, and use the cache result if it exists. \n    if (sessionStorage.hasOwnProperty(canMakePaymentCache)) {\n      return Promise.resolve(JSON.parse(sessionStorage[canMakePaymentCache]));\n    } // If canMakePayment() isn't available, default to assuming that the method is supported\n\n\n    var canMakePaymentPromise = request.canMakePayment();\n\n    if (request.canMakePayment) {\n      canMakePaymentPromise = request.canMakePayment();\n    }\n\n    return canMakePaymentPromise.then(function (result) {\n      sessionStorage[canMakePaymentCache] = result;\n      return result;\n    }).catch(function (err) {\n      alert('Error calling canMakePayment: ' + err);\n      console.log('Error calling canMakePayment: ' + err);\n    });\n  };\n\n  const showPaymentUI = (request, canMakePayment) => {\n    if (!canMakePayment) {\n      handleNotReadyToPay();\n      return;\n    } // Set payment timeout.\n\n\n    var paymentTimeout = window.setTimeout(function () {\n      window.clearTimeout(paymentTimeout);\n      request.abort().then(function () {\n        alert('Payment timed out after 20 mins 129');\n        console.log('Payment timed out after 20 mins');\n      }).catch(function () {\n        alert('Unable to abort,user is in process of paying 132');\n        console.log('Unable to abort,user is in process of paying');\n      });\n    }, 20 * 60 * 1000);\n    request.show().then(function (paymentResponse) {\n      window.clearTimeout(paymentTimeout);\n      alert(\"Request Success\");\n      console.log(paymentResponse);\n      processResponse(paymentResponse); // Handle response from browser\n    }).catch(function (err) {\n      alert(err + '142');\n      console.log(err);\n    });\n  };\n\n  const handleNotReadyToPay = () => {\n    alert(\"Tez is not ready to handle 149\");\n  };\n\n  const processResponse = paymentResponse => {\n    var paymentResponseString = paymentResponseToJsonString(paymentResponse);\n    console.log(paymentResponseString);\n    /* fetch('/buy',{\r\n        method: 'POST',\r\n        headers: new Headers({'Content-Type':'application/json'}),\r\n        body:paymentResponseString\r\n    })\r\n    .then(function(buyResult){\r\n        console.log('Buy Result'+buyResult);   \r\n    })\r\n    .catch(function(err){\r\n      console.log('Unable to process payment. '+err);   \r\n    });*/\n  };\n\n  const loadScript = src => {\n    return new Promise(resolve => {\n      const script = document.createElement('script');\n      script.src = src;\n\n      script.onload = () => {\n        resolve(true);\n      };\n\n      script.onerror = () => {\n        resolve(false);\n      };\n\n      document.body.appendChild(script);\n    });\n  };\n\n  const razorPayPaymentHandler = async filledData => {\n    const res = await loadScript('https://checkout.razorpay.com/v1/checkout.js');\n\n    if (!res) {\n      alert('Razorpay SDK failed to load. Are you online?');\n      return;\n    }\n\n    const API_URL = `http://localhost:7000/razorpay/`;\n    const orderUrl = `${API_URL}order`;\n    const response = await Axios.post(orderUrl, {\n      amount: 1\n    });\n    const {\n      data\n    } = response;\n    console.log(\"App -> razorPayPaymentHandler -> data\", data);\n    const options = {\n      key: \"\",\n      //replace razorpay API key\n      name: filledData.name,\n      description: filledData.firstName,\n      order_id: data.id,\n      handler: async response => {\n        try {\n          const paymentId = response.razorpay_payment_id;\n          console.log(paymentId);\n          const url = `http://localhost:7000/razorpay/capture/${paymentId}`;\n          const captureResponse = await Axios.post(url, {\n            amount: 1\n          });\n          const successObj = JSON.parse(captureResponse.data);\n          const captured = successObj.captured;\n          console.log(\"App -> razorPayPaymentHandler -> captured\", successObj);\n\n          if (captured) {\n            // swal(\"Payment Successfull\", \"\", \"success\");\n            console.log(\"success\");\n            this.setState({\n              name: \"\",\n              decription: \"\",\n              amount: \"\"\n            });\n          }\n        } catch (err) {\n          console.log(err);\n        }\n      },\n      theme: {\n        color: \"#686CFD\"\n      }\n    };\n    const rzp1 = new window.Razorpay(options);\n    rzp1.open();\n  };\n\n  const onSuccess = payment => {\n    console.log(payment);\n    router.push({\n      pathname: \"/page/order-success\",\n      state: {\n        payment: payment,\n        items: cartItems,\n        orderTotal: total,\n        symbol: symbol\n      }\n    });\n  };\n\n  const onSubmit = data => {\n    if (data !== \"\") {\n      if (payment == \"stripe\") {} else if (payment == \"Razorpay\") {\n        razorPayPaymentHandler(data);\n      } else if (payment == \"Gpay\") {\n        onBuyClicked(); // razorPayPaymentHandler(data);\n      } // getServerSideProps();\n      // const paymentIntent  =  stripe.paymentIntents.create({\n      //   amount: 1,\n      //   currency: 'usd',\n      //   payment_method_types: ['card'],\n      //   receipt_email: 'jenny.rosen@example.com',\n      // }).then((res)=>{\n      //   console.log(res);\n      // });\n      // setPayment\n\n    } else {\n      errors.showMessages();\n    }\n  };\n\n  const setStateFromInput = event => {\n    obj[event.target.name] = event.target.value;\n    setObj(obj);\n  };\n\n  const onCancel = data => {\n    console.log(\"The payment was cancelled!\", data);\n  };\n\n  const onError = err => {\n    console.log(\"Paypal not display\");\n    console.log(\"Error!\", err);\n  };\n\n  const paypalOptions = {\n    clientId: \"ASgLRZ4iCd_ijakIF5qE9CLiJY-lOiQN9kF50GNJ4d4g5lCJq5PhIaqhOSI9bJObkp4X6mgD0Op_DBCf\",\n    currency: \"USD\",\n    debug: true,\n    intent: \"capture\"\n  };\n  return __jsx(\"section\", {\n    className: \"section-b-space\"\n  }, __jsx(Container, null, __jsx(\"div\", {\n    className: \"checkout-page\"\n  }, __jsx(\"div\", {\n    className: \"checkout-form\"\n  }, __jsx(Form, {\n    onSubmit: handleSubmit(onSubmit)\n  }, __jsx(Row, null, __jsx(Col, {\n    lg: \"6\",\n    sm: \"12\",\n    xs: \"12\"\n  }, __jsx(\"div\", {\n    className: \"checkout-title\"\n  }, __jsx(\"h3\", null, \"Billing Details\")), __jsx(\"div\", {\n    className: \"row check-out\"\n  }, __jsx(\"div\", {\n    className: \"form-group col-md-6 col-sm-6 col-xs-12\"\n  }, __jsx(\"div\", {\n    className: \"field-label\"\n  }, \"First Name\"), __jsx(\"input\", {\n    type: \"text\",\n    className: `${errors.firstName ? \"error_border\" : \"\"}`,\n    name: \"first_name\",\n    ref: register({\n      required: true\n    })\n  }), __jsx(\"span\", {\n    className: \"error-message\"\n  }, errors.firstName && \"First name is required\")), __jsx(\"div\", {\n    className: \"form-group col-md-6 col-sm-6 col-xs-12\"\n  }, __jsx(\"div\", {\n    className: \"field-label\"\n  }, \"Last Name\"), __jsx(\"input\", {\n    type: \"text\",\n    className: `${errors.last_name ? \"error_border\" : \"\"}`,\n    name: \"last_name\",\n    ref: register({\n      required: true\n    })\n  }), __jsx(\"span\", {\n    className: \"error-message\"\n  }, errors.last_name && \"Last name is required\")), __jsx(\"div\", {\n    className: \"form-group col-md-6 col-sm-6 col-xs-12\"\n  }, __jsx(\"div\", {\n    className: \"field-label\"\n  }, \"Phone\"), __jsx(\"input\", {\n    type: \"text\",\n    name: \"phone\",\n    className: `${errors.phone ? \"error_border\" : \"\"}`,\n    ref: register({\n      pattern: /\\d+/\n    })\n  }), __jsx(\"span\", {\n    className: \"error-message\"\n  }, errors.phone && \"Please enter number for phone.\")), __jsx(\"div\", {\n    className: \"form-group col-md-6 col-sm-6 col-xs-12\"\n  }, __jsx(\"div\", {\n    className: \"field-label\"\n  }, \"Email Address\"), __jsx(\"input\", {\n    className: \"form-control\",\n    className: `${errors.email ? \"error_border\" : \"\"}`,\n    type: \"text\",\n    name: \"email\",\n    ref: register({\n      required: true,\n      pattern: /^\\S+@\\S+$/i\n    })\n  }), __jsx(\"span\", {\n    className: \"error-message\"\n  }, errors.email && \"Please enter proper email address .\")), __jsx(\"div\", {\n    className: \"form-group col-md-12 col-sm-12 col-xs-12\"\n  }, __jsx(\"div\", {\n    className: \"field-label\"\n  }, \"Country\"), __jsx(\"select\", {\n    name: \"country\",\n    ref: register({\n      required: true\n    })\n  }, __jsx(\"option\", null, \"India\"), __jsx(\"option\", null, \"South Africa\"), __jsx(\"option\", null, \"United State\"), __jsx(\"option\", null, \"Australia\"))), __jsx(\"div\", {\n    className: \"form-group col-md-12 col-sm-12 col-xs-12\"\n  }, __jsx(\"div\", {\n    className: \"field-label\"\n  }, \"Address\"), __jsx(\"input\", {\n    className: \"form-control\",\n    className: `${errors.address ? \"error_border\" : \"\"}`,\n    type: \"text\",\n    name: \"address\",\n    ref: register({\n      required: true,\n      min: 20,\n      max: 120\n    }),\n    placeholder: \"Street address\"\n  }), __jsx(\"span\", {\n    className: \"error-message\"\n  }, errors.address && \"Please right your address .\")), __jsx(\"div\", {\n    className: \"form-group col-md-12 col-sm-12 col-xs-12\"\n  }, __jsx(\"div\", {\n    className: \"field-label\"\n  }, \"Town/City\"), __jsx(\"input\", {\n    className: \"form-control\",\n    type: \"text\",\n    className: `${errors.city ? \"error_border\" : \"\"}`,\n    name: \"city\",\n    ref: register({\n      required: true\n    }),\n    onChange: setStateFromInput\n  }), __jsx(\"span\", {\n    className: \"error-message\"\n  }, errors.city && \"select one city\")), __jsx(\"div\", {\n    className: \"form-group col-md-12 col-sm-6 col-xs-12\"\n  }, __jsx(\"div\", {\n    className: \"field-label\"\n  }, \"State / County\"), __jsx(\"input\", {\n    className: \"form-control\",\n    type: \"text\",\n    className: `${errors.state ? \"error_border\" : \"\"}`,\n    name: \"state\",\n    ref: register({\n      required: true\n    }),\n    onChange: setStateFromInput\n  }), __jsx(\"span\", {\n    className: \"error-message\"\n  }, errors.state && \"select one state\")), __jsx(\"div\", {\n    className: \"form-group col-md-12 col-sm-6 col-xs-12\"\n  }, __jsx(\"div\", {\n    className: \"field-label\"\n  }, \"Postal Code\"), __jsx(\"input\", {\n    className: \"form-control\",\n    type: \"text\",\n    name: \"pincode\",\n    className: `${errors.pincode ? \"error_border\" : \"\"}`,\n    ref: register({\n      pattern: /\\d+/\n    })\n  }), __jsx(\"span\", {\n    className: \"error-message\"\n  }, errors.pincode && \"Required integer\")), __jsx(\"div\", {\n    className: \"form-group col-lg-12 col-md-12 col-sm-12 col-xs-12\"\n  }, __jsx(\"input\", {\n    type: \"checkbox\",\n    name: \"create_account\",\n    id: \"account-option\"\n  }), \"\\u2002\", \" \", __jsx(\"label\", {\n    htmlFor: \"account-option\"\n  }, \"Create An Account?\")))), __jsx(Col, {\n    lg: \"6\",\n    sm: \"12\",\n    xs: \"12\"\n  }, cartItems && cartItems.length > 0 > 0 ? __jsx(\"div\", {\n    className: \"checkout-details\"\n  }, __jsx(\"div\", {\n    className: \"order-box\"\n  }, __jsx(\"div\", {\n    className: \"title-box\"\n  }, __jsx(\"div\", null, \"Product \", __jsx(\"span\", null, \"Total\"))), __jsx(\"ul\", {\n    className: \"qty\"\n  }, cartItems.map((item, index) => __jsx(\"li\", {\n    key: index\n  }, item.title, \" \\xD7 \", item.qty, __jsx(\"span\", null, symbol, item.total.toFixed(2))))), __jsx(\"ul\", {\n    className: \"sub-total\"\n  }, __jsx(\"li\", null, \"Subtotal\", __jsx(\"span\", {\n    className: \"count\"\n  }, symbol, cartTotal)), __jsx(\"li\", null, \"Shipping\", __jsx(\"div\", {\n    className: \"shipping\"\n  }, __jsx(\"div\", {\n    className: \"shopping-option\"\n  }, __jsx(\"input\", {\n    type: \"checkbox\",\n    name: \"free-shipping\",\n    id: \"free-shipping\"\n  }), __jsx(\"label\", {\n    htmlFor: \"free-shipping\"\n  }, \"Free Shipping\")), __jsx(\"div\", {\n    className: \"shopping-option\"\n  }, __jsx(\"input\", {\n    type: \"checkbox\",\n    name: \"local-pickup\",\n    id: \"local-pickup\"\n  }), __jsx(\"label\", {\n    htmlFor: \"local-pickup\"\n  }, \"Local Pickup\"))))), __jsx(\"ul\", {\n    className: \"total\"\n  }, __jsx(\"li\", null, \"Total\", \" \", __jsx(\"span\", {\n    className: \"count\"\n  }, symbol, cartTotal)))), __jsx(\"div\", {\n    className: \"payment-box\"\n  }, __jsx(\"div\", {\n    className: \"upper-box\"\n  }, __jsx(\"div\", {\n    className: \"payment-options\"\n  }, __jsx(\"ul\", null, __jsx(\"li\", null, __jsx(\"div\", {\n    className: \"radio-option gpay\"\n  }, __jsx(\"input\", {\n    type: \"radio\",\n    name: \"payment-group\",\n    id: \"payment-4\",\n    defaultChecked: true,\n    onClick: () => checkhandle(\"Gpay\")\n  }), __jsx(\"label\", {\n    htmlFor: \"payment-4\"\n  }, \"Gpay\"))), __jsx(\"li\", null, __jsx(\"div\", {\n    className: \"radio-option Razorpay\"\n  }, __jsx(\"input\", {\n    type: \"radio\",\n    name: \"payment-group\",\n    id: \"payment-3\",\n    onClick: () => checkhandle(\"Razorpay\")\n  }), __jsx(\"label\", {\n    htmlFor: \"payment-3\"\n  }, \"Razorpay\"))), __jsx(\"li\", null, __jsx(\"div\", {\n    className: \"radio-option stripe\"\n  }, __jsx(\"input\", {\n    type: \"radio\",\n    name: \"payment-group\",\n    id: \"payment-2\",\n    onClick: () => checkhandle(\"stripe\")\n  }), __jsx(\"label\", {\n    htmlFor: \"payment-2\"\n  }, \"Stripe\"))), __jsx(\"li\", null, __jsx(\"div\", {\n    className: \"radio-option paypal\"\n  }, __jsx(\"input\", {\n    type: \"radio\",\n    name: \"payment-group\",\n    id: \"payment-1\",\n    onClick: () => checkhandle(\"paypal\")\n  }), __jsx(\"label\", {\n    htmlFor: \"payment-1\"\n  }, \"PayPal\", __jsx(\"span\", {\n    className: \"image\"\n  }, __jsx(Media, {\n    src: paypal,\n    alt: \"\"\n  })))))))), cartTotal !== 0 ? __jsx(\"div\", {\n    className: \"text-right\"\n  }, payment === \"stripe\" ? __jsx(\"button\", {\n    type: \"submit\",\n    className: \"btn-solid btn\"\n  }, \"Place Order\") : payment === \"paypal\" ? __jsx(PayPalButton, {\n    paypalOptions: paypalOptions,\n    amount: 1,\n    onPaymentSuccess: onSuccess,\n    onPaymentError: onError,\n    onApprove: onSuccess,\n    onPaymentCancel: onCancel\n  }) : payment === \"Razorpay\" ? __jsx(\"button\", {\n    type: \"submit\",\n    className: \"btn-solid btn\"\n  }, \"Razorpay Place Order\") : __jsx(\"button\", {\n    type: \"submit\",\n    className: \"btn-solid btn\"\n  }, \"Gpay Place Order\")) : \"\")) : \"\")))))));\n};\n\nexport default CheckoutPage;","map":null,"metadata":{},"sourceType":"module"}